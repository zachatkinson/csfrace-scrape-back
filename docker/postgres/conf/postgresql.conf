# PostgreSQL 17.6 Configuration for CSF Race Scraper
# Optimized for concurrent web scraping workload

# Connection Settings
listen_addresses = '*'
port = 5432

# Memory Settings (will be overridden by docker compose command args)
# These are documented here for reference
# shared_buffers = 256MB          # 25-40% of system memory
# work_mem = 16MB                 # Per-operation memory
# maintenance_work_mem = 64MB     # Maintenance operations
# effective_cache_size = 1GB      # Available system cache

# WAL (Write-Ahead Logging) Settings
# wal_buffers = 16MB              # WAL buffer size
# checkpoint_timeout = 15min      # Checkpoint frequency
# max_wal_size = 2GB             # Maximum WAL size
# min_wal_size = 1GB             # Minimum WAL size
wal_level = replica               # For replication support
archive_mode = off                # Disable archiving for development

# Query Tuning
random_page_cost = 1.1            # Optimized for SSD
seq_page_cost = 1.0
cpu_tuple_cost = 0.01
cpu_index_tuple_cost = 0.005
cpu_operator_cost = 0.0025

# Autovacuum Settings (optimized for high-write workload)
autovacuum = on
autovacuum_max_workers = 3
autovacuum_vacuum_threshold = 50
autovacuum_vacuum_scale_factor = 0.1
autovacuum_analyze_threshold = 50
autovacuum_analyze_scale_factor = 0.05

# Logging Settings
log_destination = 'stderr'
logging_collector = off           # Docker handles log collection
log_min_messages = warning
log_min_error_statement = error
log_min_duration_statement = 100  # Log slow queries (100ms+)
log_statement = 'all'             # Log all statements for development
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Lock Management
deadlock_timeout = 1s
max_locks_per_transaction = 64

# Background Writer
bgwriter_delay = 200ms
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# Checkpoint Settings
checkpoint_completion_target = 0.9
checkpoint_warning = 30s

# Connection Settings
max_connections = 200             # Increased for concurrent scraping